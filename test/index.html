
<html>
    <head>
    <title>Bayeux Test!!!</title>
    <script type="text/javascript" src = "/btest/json.js"> </script>
    <script type="text/javascript" src = "/btest/test.js"> </script>
    <script type="text/javascript" defer >
        // info about each of the channels
        var clientId = null;
        var channels = [
            {'started': false},
            {'started': false},
            {'started': false},
            {'started': false},
            {'started': false},
        ];

        function onChannelClicked(channel)
        {
            var command = document.getElementById("channel" + channel).value;

            channels['started'] = !channels['started'];
            document.getElementById("channel" + channel).value =
                                    channels['started'] ? "Stop" : "Start";
        }

        function SubscribeToChannel(channel)
        {
            function callback(request, response)
            {
                if (request.readyState == 4)
                {
                    alert("Subscription Result for channel (" + channel + "): " + request.responseText);
                }
            }

            var data = {'channel': '/meta/subscribe',
                        'clientId': clientId,
                        'subscription': '/bayeux/channel' + channel};

            var datastr = JSON.encode(data);
            MakeAjaxRequest("POST", "/bayeux/", callback, datastr, datastr.length);
        }

        function handshake()
        {
            // subscribe to all channels
            function callback(request, response)
            {
                if (request.readyState == 4)
                {
                    // woo whoo success
                    var result = JSON.decode(request.responseText);
                    clientId = result['clientId'];
                    alert("Client ID: " + clientId);

                    // now do the subscriptions!!
                    for (var i = 1;i <= 5;i++)
                    {
                        SubscribeToChannel(i);
                    }
                }
            }

            var data = {'channel': '/meta/handshake',
                        'version': '1.0',
                        'supportedConnectionTypes': ['long-polling',
                                                     'callback-polling',
                                                     'iframe']};
            var datastr = JSON.encode(data);
            MakeAjaxRequest("POST", "/bayeux/", callback, datastr, datastr.length);
        }

        function onDocumentLoaded()
        {
            handshake();
        }

        window.onload = onDocumentLoaded;
    </script>
    </head>
    <body>
        <table style="width: 100%; height: 100%" border = 1>
        <tr>
        <td> <center> Channel 1: <br>
            <input id = "channel1" name = "channel1"
                   type="button" value = "Start"
                   onclick = "return onChannelClicked(1);"/>
        </center> </td>
        <td> <center> Channel 2: <br>
            <input id = "channel2" name = "channel2"
                   type="button" value = "Start"
                   onclick = "return onChannelClicked(2);"/>
        </center> </td>
        <td> <center> Channel 3: <br>
            <input id = "channel3" name = "channel3"
                   type="button" value = "Start"
                   onclick = "return onChannelClicked(3);"/>
        </center> </td>
        <td> <center> Channel 4: <br>
            <input id = "channel4" name = "channel4"
                   type="button" value = "Start"
                   onclick = "return onChannelClicked(4);"/>
        </center> </td>
        <td> <center> Channel 5: <br>
            <input id = "channel5" name = "channel5"
                   type="button" value = "Start"
                   onclick = "return onChannelClicked(5);"/>
        </center> </td>
        </tr>
        <tr style="height: 100%">
        <td colspan = 5 style="width: 100%; height: 100%">
            <p><br> Bayeux Logs:
            <br><textarea id = 'bayeuxLogs' style='width: 100%; height: 100%; bottom: 0px' rows = 20></textarea>
        </td>
        </tr>
        </table>
    </body>
</html>

